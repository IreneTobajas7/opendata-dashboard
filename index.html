<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Deporte Escolar en Bizkaia (2018-2024) | Representación Dinámica de Datos</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      color-scheme: light;
      --bg: #f6f7f5;
      --ink: #0e1c1a;
      --ink-light: #1a2d29;
      --muted: #51635e;
      --muted-light: #6b7d78;
      --card: #ffffff;
      --brand: #0f766e;
      --brand-light: #14a399;
      --brand-dark: #0b3a36;
      --accent: #ff8a3d;
      --accent-light: #ffa366;
      --accent-dark: #e6732a;
      --shadow: 0 20px 50px rgba(0,0,0,0.08);
      --shadow-soft: 0 8px 24px rgba(15, 118, 110, 0.12);
      --grid: rgba(15, 118, 110, 0.08);
      --pill: rgba(15, 118, 110, 0.1);
      --border-radius: 12px;
      --border-radius-large: 16px;
      --transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: 'Space Grotesk', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
      background: 
        radial-gradient(circle at 5% 15%, rgba(15,118,110,0.08), transparent 40%),
        radial-gradient(circle at 95% 85%, rgba(255,138,61,0.08), transparent 40%),
        linear-gradient(135deg, #fafbf9 0%, #f5f7f4 50%, #faf8f5 100%);
      color: var(--ink);
      line-height: 1.6;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      min-height: 100vh;
    }
    body.dark {
      --bg:#050f0d;
      --ink:#effaf7;
      --ink-light:#d1e5de;
      --muted:#9bb0a9;
      --muted-light:#7f928c;
      --card:#0f1d1a;
      --brand-dark:#5eead4;
      --brand-light:#99f6e4;
      --pill:rgba(94,234,212,0.12);
      --grid:rgba(94,234,212,0.18);
      background:
        radial-gradient(circle at 5% 15%, rgba(94,234,212,0.08), transparent 40%),
        radial-gradient(circle at 95% 85%, rgba(251,146,60,0.08), transparent 40%),
        linear-gradient(135deg, #061210 0%, #04100e 60%, #030a08 100%);
      color:var(--ink);
    }
    header {
      position: sticky;
      top:0;
      z-index:100;
      display: flex;
      justify-content: space-between;
      align-items:center;
      padding: 0.75rem 1.25rem;
      background: linear-gradient(115deg, rgba(11,58,54,0.98), rgba(15,118,110,0.96));
      color: #eef6f3;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1), 0 2px 4px rgba(0,0,0,0.06), inset 0 1px 0 rgba(255,255,255,0.1);
      backdrop-filter: blur(12px);
      border-bottom: 2px solid rgba(255,255,255,0.1);
      flex-shrink:0;
      min-height:auto;
    }
    header h1 {
      margin:0;
      font-size:clamp(0.95rem, 2vw, 1.25rem);
      font-weight:800;
      letter-spacing:-0.02em;
      text-shadow: 0 2px 8px rgba(0,0,0,0.2);
      line-height:1.2;
    }
    header .meta {
      font-size:clamp(0.55rem, 1.2vw, 0.75rem);
      text-transform:uppercase;
      letter-spacing:0.1em;
      opacity:0.9;
      margin-top:0.2rem;
      font-weight:600;
    }
    .header-actions {
      display:flex;
      gap:0.5rem;
    }
    .header-link {
      padding:0.6rem 1.25rem;
      border-radius:999px;
      border:2px solid rgba(255,255,255,0.35);
      color:#fff;
      text-decoration:none;
      font-weight:700;
      font-size:0.8125rem;
      background:rgba(255,255,255,0.18);
      backdrop-filter:blur(10px);
      transition:var(--transition);
      letter-spacing:0.02em;
      text-transform:uppercase;
      box-shadow:0 2px 6px rgba(0,0,0,0.15), inset 0 1px 0 rgba(255,255,255,0.2);
      display:inline-block;
      white-space:nowrap;
    }
    .header-link:hover {
      background:rgba(255,255,255,0.3);
      border-color:rgba(255,255,255,0.7);
      transform:translateY(-1px) scale(1.02);
      box-shadow:0 4px 12px rgba(0,0,0,0.2), inset 0 1px 0 rgba(255,255,255,0.3);
    }
    button.header-link {
      cursor:pointer;
      font-family:inherit;
      border:2px solid rgba(255,255,255,0.35);
      background:rgba(255,255,255,0.18);
    }

    html, body {
      margin:0;
      padding:0;
      height:100%;
      width:100%;
      overflow-x:hidden;
      box-sizing:border-box;
    }
    *, *::before, *::after {
      box-sizing:inherit;
    }
    body {
      overflow-x:hidden;
      overflow-y:auto;
      min-height:100vh;
    }
    .dashboard-container {
      display:flex;
      flex-direction:column;
      min-height:100vh;
      width:100%;
      overflow:visible;
    }
    .command-center {
      width:100%;
      max-width:100%;
      margin:0;
      padding:0;
      display:flex;
      flex-direction:column;
      gap:0;
      flex:1;
      min-height:0;
      overflow:visible;
      box-sizing:border-box;
    }
    .command-center-main {
      flex:1;
      min-height:0;
      overflow:visible;
    }

    /* LAYOUT PRINCIPAL: SIDEBAR + CONTENIDO */
.dashboard-layout {
      display:flex;
      align-items:stretch;
      gap:0.75rem;
      width:100%;
      max-width:none;
      margin:0;
      padding:0.75rem;
      box-sizing:border-box;
      min-height:calc(100vh - 80px); /* Altura mínima flexible basada en viewport */
      overflow:visible; /* Permitir scroll si el contenido es más alto */
    }
    .dashboard-sidebar {
      width:220px;
      flex:0 0 220px;
      position:sticky;
      top:calc(80px + 0.75rem); /* Header height + padding del dashboard-layout para alinearse con el panel */
      max-height:calc(100vh - 80px - 0.75rem);
      overflow-y:auto;
      overflow-x:hidden;
      box-sizing:border-box;
      padding:0.5rem;
      background:#ffffff;
      border-radius:12px;
      box-shadow:0 4px 12px rgba(0,0,0,0.06);
      border:1px solid rgba(15,118,110,0.1);
      display:flex;
      flex-direction:column;
      gap:0.5rem;
      align-self:flex-start; /* Alinear arriba con los visuales */
    }
    .dashboard-sidebar::-webkit-scrollbar {
      width:4px;
    }
    .dashboard-sidebar::-webkit-scrollbar-thumb {
      background:rgba(15,118,110,0.3);
      border-radius:4px;
    }
    .click-filter-info {
      width:100%;
      margin-top:0.75rem;
      flex-shrink:0;
    }
    .click-filter-info-content {
      padding:0.75rem;
      background:linear-gradient(135deg, #f0fdf4, #ecfdf5);
      border:1px solid rgba(15,118,110,0.2);
      border-radius:10px;
      box-shadow:0 2px 8px rgba(15,118,110,0.12);
      font-size:0.8125rem;
      line-height:1.5;
      color:var(--ink-light);
    }
    .click-filter-info-content strong {
      display:block;
      margin-bottom:0.4rem;
      color:var(--brand-dark);
      font-size:0.875rem;
      font-weight:700;
    }
    .click-filter-info-content p {
      margin:0;
      font-size:0.8125rem;
      line-height:1.5;
      color:var(--ink-light);
      text-align:justify;
    }
    body.dark .click-filter-info-content {
      background:linear-gradient(135deg, rgba(15,30,27,0.95), rgba(10,20,18,0.9));
      border-color:rgba(94,234,212,0.3);
      box-shadow:0 2px 8px rgba(94,234,212,0.15);
    }
    body.dark .click-filter-info-content strong {
      color:var(--brand-light);
    }
    body.dark .click-filter-info-content p {
      color:var(--ink-light);
    }
    @media (max-width: 1024px) {
      .click-filter-info {
        margin-top:0.5rem; /* Reducir margen en pantallas pequeñas */
      }
    }
    .dashboard-main {
      flex:1 1 auto;
      min-width:0;
      display:flex;
      flex-direction:column;
      min-height:0;
      height:100%;
      gap:0;
      overflow:hidden;
      width:100%;
    }
    /* Layout específico pestaña 1 - ahora manejado por el grid vertical de 2 filas */

    .hero {
      display:grid;
      grid-template-columns: repeat(auto-fit,minmax(300px,1fr));
      gap:clamp(2rem, 4vw, 3.5rem);
      align-items:center;
      background:linear-gradient(135deg, #ffffff 0%, #fafbf9 50%, #f5f7f4 100%);
      border-radius:20px;
      padding:clamp(2.5rem, 5vw, 4rem);
      box-shadow:0 32px 80px rgba(15,118,110,0.15), 0 12px 32px rgba(0,0,0,0.1), inset 0 1px 0 rgba(255,255,255,0.9);
      border:2px solid rgba(15,118,110,0.12);
      position:relative;
      overflow:hidden;
    }
    .hero::before {
      content:'';
      position:absolute;
      top:0;
      left:0;
      right:0;
      height:5px;
      background:linear-gradient(90deg, var(--brand) 0%, var(--brand-light) 50%, var(--accent) 100%);
      box-shadow:0 2px 8px rgba(15,118,110,0.3);
    }
    .hero::after {
      content:'';
      position:absolute;
      top:-50%;
      right:-10%;
      width:400px;
      height:400px;
      background:radial-gradient(circle, rgba(15,118,110,0.08) 0%, transparent 70%);
      border-radius:50%;
      pointer-events:none;
    }
    .eyebrow {
      text-transform:uppercase;
      letter-spacing:0.15em;
      font-size:0.75rem;
      color:var(--brand);
      margin:0 0 0.75rem;
      font-weight:700;
      display:inline-block;
      padding:0.375rem 0.875rem;
      background:rgba(15,118,110,0.1);
      border-radius:999px;
    }
    .hero-title {
      margin:0 0 1.25rem;
      font-size:clamp(2.25rem, 5vw, 3.25rem);
      font-weight:800;
      letter-spacing:-0.04em;
      line-height:1.1;
      background:linear-gradient(135deg, var(--brand-dark) 0%, var(--brand) 50%, var(--accent-dark) 100%);
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
      background-clip:text;
      position:relative;
    }
    .hero-subtitle {
      margin:0 0 2rem;
      color:var(--muted);
      font-size:clamp(1.0625rem, 1.75vw, 1.25rem);
      line-height:1.7;
      max-width:70ch;
      font-weight:500;
    }
    .hero-teasers {
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(140px,1fr));
      gap:1rem;
      margin:1.5rem 0;
    }
    .teaser {
      background:linear-gradient(135deg, rgba(255,255,255,0.9), rgba(255,255,255,0.7));
      border:2.5px solid rgba(15,118,110,0.25);
      border-radius:14px;
      padding:1.25rem 1.5rem;
      transition:var(--transition);
      cursor:default;
      position:relative;
      overflow:hidden;
    }
    .teaser::before {
      content:'';
      position:absolute;
      top:0;
      left:0;
      right:0;
      height:3px;
      background:linear-gradient(90deg, var(--brand), var(--brand-light));
      transform:scaleX(0);
      transition:transform 0.3s ease;
    }
    .teaser:hover {
      transform:translateY(-4px) scale(1.02);
      box-shadow:0 12px 32px rgba(15,118,110,0.2), 0 4px 12px rgba(0,0,0,0.1);
      border-color:var(--brand);
      background:linear-gradient(135deg, #ffffff, rgba(255,255,255,0.95));
    }
    .teaser:hover::before {
      transform:scaleX(1);
    }
    .teaser-value {
      font-size:clamp(1.75rem, 3vw, 2.5rem);
      font-weight:800;
      background:linear-gradient(135deg, var(--brand-dark), var(--brand));
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
      background-clip:text;
      letter-spacing:-0.03em;
      margin-bottom:0.375rem;
      line-height:1;
    }
    .teaser-label {
      font-size:0.8125rem;
      color:var(--muted);
      font-weight:600;
      text-transform:uppercase;
      letter-spacing:0.05em;
    }
    .hero-actions {
      display:flex;
      gap:0.75rem;
      flex-wrap:wrap;
      margin:1.5rem 0 0;
    }
    .btn {
      padding:0.875rem 1.75rem;
      border-radius:12px;
      border:none;
      font-weight:700;
      font-size:0.9375rem;
      cursor:pointer;
      background:linear-gradient(135deg, var(--brand) 0%, #128673 100%);
      color:#fff;
      box-shadow:0 10px 28px rgba(15,118,110,0.35), 0 4px 12px rgba(0,0,0,0.15), inset 0 1px 0 rgba(255,255,255,0.2);
      transition:var(--transition);
      letter-spacing:0.03em;
      position:relative;
      overflow:hidden;
      text-transform:uppercase;
      font-size:0.8125rem;
    }
    .btn::before {
      content:'';
      position:absolute;
      top:0;
      left:-100%;
      width:100%;
      height:100%;
      background:linear-gradient(90deg, transparent, rgba(255,255,255,0.25), transparent);
      transition:left 0.6s ease;
    }
    .btn:hover::before {
      left:100%;
    }
    .btn:hover {
      transform:translateY(-3px) scale(1.02);
      box-shadow:0 16px 40px rgba(15,118,110,0.45), 0 8px 16px rgba(0,0,0,0.2), inset 0 1px 0 rgba(255,255,255,0.3);
      background:linear-gradient(135deg, #128673 0%, var(--brand-light) 100%);
    }
    .btn:active {
      transform:translateY(-1px) scale(0.98);
    }
    .btn.secondary {
      background:rgba(255,255,255,0.95);
      color:var(--brand-dark);
      border:1.5px solid rgba(15,118,110,0.3);
      box-shadow:0 2px 6px rgba(15,118,110,0.12), inset 0 1px 0 rgba(255,255,255,0.8);
      padding:0.375rem 0.75rem;
      font-size:0.6875rem;
    }
    .btn.secondary:hover {
      background:#fff;
      border-color:var(--brand);
      box-shadow:0 8px 20px rgba(15,118,110,0.2), inset 0 1px 0 rgba(255,255,255,1);
      transform:translateY(-2px) scale(1.01);
    }
    .hero-questions {
      display:flex;
      flex-wrap:wrap;
      gap:0.5rem;
      font-size:0.875rem;
      color:var(--muted);
      margin-top:1rem;
    }
    .hero-questions span {
      background:linear-gradient(135deg, rgba(15,118,110,0.12), rgba(15,118,110,0.08));
      padding:0.5rem 0.875rem;
      border-radius:999px;
      font-weight:700;
      border:2px solid rgba(15,118,110,0.2);
      box-shadow:0 2px 6px rgba(15,118,110,0.1);
      transition:var(--transition);
      font-size:0.8125rem;
    }
    .hero-questions span:hover {
      transform:translateY(-2px) scale(1.05);
      border-color:var(--brand);
      box-shadow:0 4px 12px rgba(15,118,110,0.15);
      background:linear-gradient(135deg, rgba(15,118,110,0.15), rgba(15,118,110,0.1));
    }
    .hero-graphic {
      min-height:320px;
      height:clamp(260px, 28vh, 360px);
      position:relative;
      background:linear-gradient(135deg, rgba(15,118,110,0.04), rgba(255,138,61,0.03));
      border-radius:16px;
      padding:1.5rem;
      border:2px solid rgba(15,118,110,0.1);
      box-shadow:inset 0 2px 8px rgba(15,118,110,0.05);
      display:flex;
      flex-direction:column;
      justify-content:center;
    }
    .hero-graphic canvas {
      width:100% !important;
      height:100% !important;
    }

    .control-panel {
      background:#fff;
      border-radius:12px;
      padding:0.5rem 0.75rem;
      box-shadow:0 20px 50px rgba(0,0,0,0.1), 0 8px 20px rgba(15,118,110,0.12);
      border:1.5px solid rgba(15,118,110,0.12);
      display:flex;
      flex-direction:column;
      width:290px;
      min-width:290px;
      flex-shrink:0;
      height:100%;
      overflow-y:hidden;
      overflow-x:hidden;
      box-sizing:border-box;
      gap:0.5rem;
      margin-top:0.75rem;
    }
    .sidebar-top {
      display:flex;
      flex-direction:column;
      gap:0.45rem;
      flex-shrink:0;
    }
    .sidebar-section {
      flex-shrink:0;
      overflow:visible;
    }
    .sidebar-section h3 {
      margin:0 0 0.5rem;
      font-size:0.6875rem;
      color:var(--brand-dark);
      font-weight:700;
    }
    .sidebar-filters-card .sidebar-section {
      margin-bottom:0;
    }
    .sidebar-insight {
      padding:0.7rem 0.8rem;
      border-radius:8px;
      border:1px solid rgba(15,118,110,0.18);
      background:linear-gradient(135deg, #f7faf9, #ffffff);
      font-size:0.75rem;
      line-height:1.35;
      min-height:50px;
      display:flex;
      flex-direction:column;
      justify-content:flex-start;
      flex-shrink:0;
      overflow:visible;
      height:auto;
    }
    .sidebar-insight h3 {
      margin:0 0 0.35rem;
      font-size:0.625rem;
      color:var(--brand-dark);
      font-weight:700;
      text-transform:uppercase;
      letter-spacing:0.05em;
    }
    .sidebar-insight .control-card {
      margin:0;
      padding:0;
      background:transparent;
      border:none;
    }
    .sidebar-insight .control-card p {
      margin:0;
      font-size:0.6875rem;
      line-height:1.4;
      color:var(--ink-light);
      font-weight:500;
      word-wrap:break-word;
      overflow-wrap:break-word;
      white-space:normal;
      text-align:justify;
    }
    .sidebar-kpis {
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:0.35rem;
      flex-shrink:0;
    }
    .sidebar-kpi-card {
      padding:0.4rem 0.5rem;
      border-radius:8px;
      border:1px solid rgba(15,118,110,0.18);
      background:#ffffff;
      display:flex;
      flex-direction:column;
      gap:0.15rem;
      transition:var(--transition);
    }
    .sidebar-kpi-card:hover {
      transform:translateY(-1px);
      box-shadow:0 3px 8px rgba(15,118,110,0.12);
      border-color:rgba(15,118,110,0.3);
    }
    .sidebar-kpi-card.highlight {
      border-color:var(--brand);
      background:linear-gradient(135deg, rgba(15,118,110,0.08), rgba(15,118,110,0.04));
    }
    .sidebar-kpi-card.alert {
      border-color:var(--accent);
    }
    .sidebar-kpi-title {
      font-size:0.6875rem;
      font-weight:600;
      opacity:0.85;
      text-transform:uppercase;
      letter-spacing:0.03em;
    }
    .sidebar-kpi-value {
      font-size:1rem;
      font-weight:700;
      line-height:1.2;
      background:linear-gradient(135deg, var(--brand-dark), var(--brand));
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
      background-clip:text;
    }
    .sidebar-kpi-card.alert .sidebar-kpi-value {
      background:linear-gradient(135deg, var(--accent-dark), var(--accent));
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
      background-clip:text;
    }
    .sidebar-kpi-context {
      display:none;
    }
    .sidebar-main {
      display:flex;
      flex-direction:column;
      flex:1;
      min-height:0;
      gap:0.5rem;
    }
    .sidebar-filters {
      margin-top:0.2rem;
      padding-top:0.3rem;
      border-top:1px solid rgba(15,118,110,0.12);
      flex-shrink:0;
      display:flex;
      flex-direction:column;
      gap:0.5rem;
    }
    .sidebar-section-title {
      font-size:0.7rem;
      font-weight:600;
      text-transform:uppercase;
      letter-spacing:0.06em;
      color:var(--brand-dark);
      margin:0 0 0.4rem;
      opacity:0.9;
    }
    .sidebar-filters-scroll {
      max-height:calc(100vh - 350px);
      overflow-y:auto;
      padding-right:0.15rem;
    }
    .sidebar-filters-list {
      display:flex;
      flex-direction:column;
      gap:0.35rem;
    }
    .sidebar-filter-field {
      padding:0.5rem 0.625rem;
      border-radius:6px;
      border:1px solid rgba(15,118,110,0.1);
      background:#ffffff;
      display:flex;
      flex-direction:column;
      gap:0.375rem;
      transition:var(--transition);
      min-height:auto;
    }
    .sidebar-filter-field:hover {
      transform:translateY(-1px);
      box-shadow:0 1px 3px rgba(15,118,110,0.08);
      border-color:rgba(15,118,110,0.2);
    }
    /* Toggle switch para excluir outliers */
    .toggle-switch {
      position:relative;
      display:inline-block;
      width:44px;
      height:24px;
    }
    .toggle-switch input {
      opacity:0;
      width:0;
      height:0;
    }
    .toggle-slider {
      position:absolute;
      cursor:pointer;
      top:0;
      left:0;
      right:0;
      bottom:0;
      background-color:#ccc;
      transition:.4s;
      border-radius:24px;
    }
    .toggle-slider:before {
      position:absolute;
      content:"";
      height:18px;
      width:18px;
      left:3px;
      bottom:3px;
      background-color:white;
      transition:.4s;
      border-radius:50%;
    }
    .toggle-switch input:checked + .toggle-slider {
      background-color:var(--brand);
    }
    .toggle-switch input:checked + .toggle-slider:before {
      transform:translateX(20px);
    }
    .toggle-switch input:focus + .toggle-slider {
      box-shadow:0 0 1px var(--brand);
    }
    .dual-range {
      display:flex;
      align-items:center;
      gap:0.4rem;
      width:100%;
    }
    .dual-range-input {
      width:68px;
      padding:0.3rem 0.45rem;
      border:1px solid rgba(15,118,110,0.2);
      border-radius:6px;
      font-size:0.7rem;
      font-weight:600;
      color:var(--brand-dark);
      text-align:center;
      background:#fff;
    }
    .dual-range-slider {
      position:relative;
      flex:1;
      height:26px;
    }
    .dual-range-track,
    .dual-range-progress {
      position:absolute;
      left:0;
      right:0;
      top:50%;
      height:4px;
      border-radius:999px;
      transform:translateY(-50%);
    }
    .dual-range-track {
      background:var(--pill);
    }
    .dual-range-progress {
      background:var(--brand);
      left:0;
      right:0;
    }
    .dual-range-slider input[type="range"] {
      position:absolute;
      left:0;
      top:0;
      width:100%;
      height:26px;
      margin:0;
      background:transparent;
      pointer-events:none;
    }
    .dual-range-slider input[type="range"]::-webkit-slider-thumb {
      pointer-events:auto;
      width:14px;
      height:14px;
      border-radius:50%;
      border:2px solid #fff;
      background:var(--brand);
      box-shadow:0 1px 4px rgba(0,0,0,0.25);
      cursor:pointer;
    }
    .dual-range-slider input[type="range"]::-moz-range-thumb {
      pointer-events:auto;
      width:14px;
      height:14px;
      border-radius:50%;
      border:2px solid #fff;
      background:var(--brand);
      box-shadow:0 1px 4px rgba(0,0,0,0.25);
      cursor:pointer;
    }
    .sidebar-filter-label {
      font-size:0.5625rem;
      font-weight:600;
      text-transform:uppercase;
      letter-spacing:0.05em;
      color:var(--brand-dark);
      opacity:0.85;
      display:flex;
      align-items:center;
      gap:0.25rem;
      margin-bottom:0;
    }
    .sidebar-filter-label span {
      display:flex;
      align-items:center;
      gap:0.3rem;
    }
    .sidebar-filter-select,
    .sidebar-filter-input {
      padding:0.25rem 0.4rem;
      font-size:0.6875rem;
      border-radius:4px;
      border:1.5px solid rgba(15,118,110,0.2);
      background-color:#fff;
      color:var(--brand-dark);
      outline:none;
      width:100%;
      box-sizing:border-box;
      font-weight:600;
    }
    .sidebar-filter-select:focus,
    .sidebar-filter-input:focus {
      border-color:var(--brand);
      box-shadow:0 0 0 1px rgba(15,118,110,0.18);
    }
    .sidebar-filter-reset {
      width:100%;
      padding:0.35rem 0.55rem;
      border-radius:6px;
      border:1.5px solid rgba(15,118,110,0.2);
      background:linear-gradient(135deg, rgba(255,255,255,0.95), rgba(255,255,255,0.85));
      color:var(--brand-dark);
      font-size:0.625rem;
      font-weight:600;
      text-transform:uppercase;
      letter-spacing:0.05em;
      cursor:pointer;
      transition:var(--transition);
      outline:none;
    }
    .sidebar-filter-reset:hover {
      transform:translateY(-1px);
      box-shadow:0 2px 8px rgba(15,118,110,0.12);
      border-color:rgba(15,118,110,0.3);
    }
    .sidebar-methodology {
      padding-top:0.4rem;
      border-top:1px solid rgba(15,118,110,0.12);
      font-size:0.625rem;
      line-height:1.3;
      opacity:0.8;
      margin-top:0.3rem;
      flex-shrink:0;
    }
    .sidebar-methodology h3 {
      margin:0 0 0.25rem;
      font-size:0.5625rem;
      color:var(--brand-dark);
      font-weight:600;
      text-transform:uppercase;
      letter-spacing:0.05em;
    }
    .sidebar-methodology .control-card {
      margin:0;
      padding:0;
      background:transparent;
      border:none;
    }
    .sidebar-methodology .control-card ul {
      margin:0;
      padding-left:0.75rem;
      font-size:0.5625rem;
      line-height:1.3;
    }
    .control-card {
      background:linear-gradient(135deg, rgba(15,118,110,0.06), rgba(15,118,110,0.03));
      border-radius:4px;
      border:1.5px solid rgba(15,118,110,0.15);
      padding:0.375rem 0.5rem;
      flex-shrink:0;
    }
    .control-card h4 {
      margin:0 0 0.125rem;
      font-size:0.625rem;
      color:var(--brand-dark);
      font-weight:700;
    }
    .control-card p,
    .control-card ul {
      margin:0;
      font-size:0.5625rem;
      line-height:1.25;
      color:var(--muted);
    }
    .control-card ul {
      padding-left:0.875rem;
    }
    .control-card li {
      margin-bottom:0.125rem;
    }
    .quick-stats {
      display:grid;
      grid-template-columns:repeat(3, 1fr);
      gap:0.25rem;
      flex-shrink:0;
    }
    .quick-stats .insight-card {
      padding:0.375rem 0.25rem;
      border-radius:6px;
      border-width:1.5px;
    }
    .quick-stats .insight-value {
      font-size:0.8125rem;
      line-height:1;
      margin-bottom:0.125rem;
    }
    .quick-stats .insight-label {
      font-size:0.5rem;
      margin-top:0;
      line-height:1.1;
    }
    .quick-stats .insight-context {
      font-size:0.4375rem;
      margin-top:0.0625rem;
      line-height:1.1;
    }
    .viz-grid {
      display:flex;
      flex-direction:column;
      flex:1 1 auto;
      min-height:0;
      height:100%;
      width:100%;
      overflow:hidden;
      padding:0;
      box-sizing:border-box;
    }

    /* GRID PESTAÑA 1 - GRID VERTICAL CON 2 FILAS PRINCIPALES */
    .tab1-grid {
      display:grid;
      grid-template-columns:repeat(12, 1fr);
      grid-template-rows:1fr 1fr;
      gap:0.75rem;
      align-items:stretch;
      padding:0;
      width:100%;
      height:100%;
      box-sizing:border-box;
      overflow:hidden;
    }
    
    /* Fila 1: 3 visuales superiores (evolución, brecha, oferta) - proporción 5:4:3 */
    .tab1-grid .panel-evolucion {
      grid-column:1 / span 5 !important;
      grid-row:1;
      height:100%;
      width:100%;
      overflow:hidden;
    }
    .tab1-grid .panel-gap-timeline {
      grid-column:6 / span 4 !important;
      grid-row:1;
      height:100%;
      width:100%;
      overflow:hidden;
    }
    .tab1-grid .panel-offer {
      grid-column:10 / span 3 !important;
      grid-row:1;
      height:100%;
      width:100%;
      overflow:hidden;
    }
    
    /* Fila 2: mapa de deportes + mapa de paridad - 6 columnas cada uno (50% cada uno) */
    .tab1-grid .panel-heatmap {
      grid-column:1 / span 6 !important;
      grid-row:2;
      height:100%;
      width:100%;
      overflow:hidden;
    }
    .tab1-grid .panel-scatter {
      grid-column:7 / span 6 !important;
      grid-row:2;
      height:100%;
      width:100%;
      overflow:hidden;
    }
    .panel {
      background:#fff;
      border-radius:8px;
      border:1px solid rgba(15,118,110,0.08);
      box-shadow:0 1px 3px rgba(0,0,0,0.04), 0 1px 2px rgba(0,0,0,0.06);
      display:flex;
      flex-direction:column;
      padding:0.75rem;
      height:100%;
      overflow:hidden;
      box-sizing:border-box;
      width:100%;
      position:relative;
    }

    /* Tarjetas de gráfico pestaña 1 */
    .chart-card {
      background:#ffffff;
      border-radius:8px;
      padding:1rem;
      box-shadow:0 1px 3px rgba(0,0,0,0.04), 0 1px 2px rgba(0,0,0,0.06);
      border:1px solid rgba(15,118,110,0.08);
      box-sizing:border-box;
      display:flex;
      flex-direction:column;
      gap:0.75rem;
      min-height:320px;
      height:100%;
      overflow:hidden;
      min-width:0;
      width:100%;
    }
    /* .panel.large solo se aplica fuera de .tab1-grid para no interferir con las asignaciones específicas */
    .panel.large {
      grid-column:span 2;
    }
    /* Sobrescribir .panel.large dentro de .tab1-grid para que no interfiera */
    .tab1-grid .panel.large {
      grid-column:unset;
    }
    @media (max-width: 1024px) {
      .panel.large {
        grid-column:span 1;
      }
      .tab1-grid .panel.large {
        grid-column:unset;
      }
    }
    .panel-header {
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:0.5rem;
      flex-shrink:0;
      min-height:24px;
      gap:0.5rem;
      flex-wrap:wrap;
    }
    .panel-header h3 {
      margin:0;
      font-size:1rem;
      color:var(--brand-dark);
      font-weight:700;
      line-height:1.2;
    }
    .panel-header small {
      font-size:0.625rem;
      color:var(--muted);
    }
    .panel-body,
    .chart-body {
      flex:1 1 0;
      min-height:120px;
      min-width:0;
      position:relative;
      overflow:hidden;
      width:100%;
    }
    .panel-body canvas,
    .panel-body svg,
    .chart-canvas {
      width:100% !important;
      height:100% !important;
      max-width:100%;
      max-height:100%;
      display:block;
    }
    /* Tabla de datos para gap-timeline */
    .gap-timeline-table-container {
      flex-shrink:0;
      min-height:60px;
      border-top:1px solid rgba(15,118,110,0.1);
    }
    .gap-timeline-table {
      width:100%;
      border-collapse:collapse;
      font-size:0.75rem;
    }
    .gap-timeline-table thead {
      display:none;
    }
    .gap-timeline-table th {
      padding:0.4rem 0.5rem;
      text-align:center;
      font-weight:600;
      color:var(--brand-dark);
      font-size:0.6875rem;
      text-transform:uppercase;
      letter-spacing:0.03em;
      border-right:1px solid rgba(15,118,110,0.15);
    }
    .gap-timeline-table th:last-child {
      border-right:none;
    }
    .gap-timeline-table td {
      padding:0.35rem 0.5rem;
      color:var(--ink-light);
      font-weight:500;
      text-align:center;
      border-right:1px solid rgba(15,118,110,0.08);
      border-bottom:1px solid rgba(15,118,110,0.08);
    }
    .gap-timeline-table td:first-child {
      text-align:center;
      font-weight:700;
      font-size:0.875rem;
      color:var(--brand-dark);
      border-right:1px solid rgba(15,118,110,0.15);
      width:2rem;
      padding:0.35rem 0.25rem;
    }
    .gap-timeline-table td:last-child {
      border-right:none;
    }
    .gap-timeline-table tbody tr:last-child td {
      border-bottom:none;
    }
    .gap-timeline-table tbody tr:hover {
      background:rgba(15,118,110,0.03);
    }
    /* Insight más grande para gap-timeline */
    .panel-gap-timeline .card-insight {
      margin-top:0.5rem;
      padding:1.25rem 1.25rem;
      font-size:0.9375rem;
      line-height:1.7;
      flex-shrink:1;
      max-height:200px;
      overflow-y:auto;
      overflow-x:hidden;
      text-align:justify;
    }
    .panel-gap-timeline .card-insight::-webkit-scrollbar {
      width:6px;
    }
    .panel-gap-timeline .card-insight::-webkit-scrollbar-thumb {
      background:rgba(15,118,110,0.3);
      border-radius:3px;
    }
    .panel-gap-timeline .card-insight::-webkit-scrollbar-track {
      background:rgba(15,118,110,0.05);
      border-radius:3px;
    }
    .panel-offer-insight {
      margin-top:0.5rem;
      padding:1.25rem 1.25rem !important;
      font-size:0.9375rem;
      line-height:1.7;
      flex-shrink:1;
      max-height:200px;
      overflow-y:auto;
      overflow-x:hidden;
      text-align:justify;
    }
    .panel-offer-insight::-webkit-scrollbar {
      width:6px;
    }
    .panel-offer-insight::-webkit-scrollbar-thumb {
      background:rgba(15,118,110,0.3);
      border-radius:3px;
    }
    .panel-offer-insight::-webkit-scrollbar-track {
      background:rgba(15,118,110,0.05);
      border-radius:3px;
    }
    /* Asegurar que el heatmap se vea bien */
    .heatmap-container {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
      gap: 0.3rem;
      width: 100%;
      min-height: 100%;
      padding: 0.5rem;
      box-sizing: border-box;
    }
    .heatmap-tile {
      aspect-ratio: 1;
      border-radius: 6px;
      border: 2px solid rgba(255, 255, 255, 0.9);
      cursor: pointer;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding: 0.25rem;
      transition: all 0.2s ease;
      position: relative;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    .heatmap-tile:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
      border-color: var(--brand-dark);
      z-index: 10;
    }
    .heatmap-tile.selected {
      border-color: var(--brand-dark);
      border-width: 3px;
      box-shadow: 0 0 0 2px rgba(15, 118, 110, 0.2);
    }
    .heatmap-tile.sin-datos {
      border-color: rgba(135, 150, 144, 0.5);
      border-style: dashed;
      position: relative;
    }
    .heatmap-tile.sin-datos::after {
      content: '⚠️';
      position: absolute;
      top: 0.25rem;
      right: 0.25rem;
      font-size: 0.75rem;
      opacity: 0.8;
    }
    .heatmap-tile.sin-datos .heatmap-tile-name {
      color: rgba(255, 255, 255, 1);
      text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);
    }
    .heatmap-tile.sin-datos .heatmap-tile-value {
      color: rgba(255, 255, 255, 1);
      text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);
    }
    .heatmap-tile-name {
      font-size: 0.6875rem;
      font-weight: 600;
      text-align: center;
      margin-bottom: 0.1rem;
      line-height: 1.1;
      color: #ffffff;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
    }
    .heatmap-tile-value {
      font-size: 0.8125rem;
      font-weight: 700;
      text-align: center;
      color: #ffffff;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
    }
    .panel-heatmap .panel-body {
      position: relative;
      overflow-y: auto;
      padding: 0.5rem;
      display: flex;
      align-items: stretch;
    }
    .panel-heatmap .card-insight {
      font-size: 0.8125rem;
      font-weight: 600;
    }
    .panel-controls {
      display:flex;
      gap:0.375rem;
      align-items:center;
      flex-wrap:wrap;
      margin-bottom:0.375rem;
      flex-shrink:0;
    }
    .panel-controls .btn.compact,
    .btn.compact {
      padding:0.5rem 1rem;
      font-size:0.75rem;
      font-weight:700;
      text-transform:uppercase;
      letter-spacing:0.03em;
    }
    .panel-controls .filter-input {
      min-width:100px;
    }
    .panel-controls .filter-select {
      padding:0.4375rem 0.625rem;
      font-size:0.75rem;
      min-width:90px;
    }
    .panel .card-insight {
      margin-top:0.75rem;
      padding:0.85rem 1rem;
      font-size:0.875rem;
      flex-shrink:0;
      line-height:1.5;
      border-radius:8px;
      background:linear-gradient(135deg, rgba(15,118,110,0.08), rgba(15,118,110,0.04));
      border-left:3px solid var(--brand);
      text-align:justify;
    }
    .panel-tabs {
      display:flex;
      gap:0.25rem;
      margin-left:auto;
    }
    .tab-btn {
      padding:0.375rem 0.625rem;
      font-size:0.625rem;
      font-weight:600;
      border:1.5px solid rgba(15,118,110,0.2);
      background:#fff;
      color:var(--brand-dark);
      border-radius:4px;
      cursor:pointer;
      transition:var(--transition);
    }
    .tab-btn:hover {
      background:rgba(15,118,110,0.05);
      border-color:rgba(15,118,110,0.3);
    }
    .tab-btn.active {
      background:var(--brand);
      color:#fff;
      border-color:var(--brand);
    }
    .panel .story-flags {
      margin:0.375rem 0;
      flex-shrink:0;
    }
    .panel .story-flags .flag {
      padding:0.25rem 0.5rem;
      font-size:0.625rem;
    }
    .panel .card-legend {
      gap:0.375rem;
      flex-shrink:0;
    }
    .panel .legend-item-small {
      font-size:0.625rem;
    }
    .dashboard-group-title {
      grid-column:span 3;
      font-size:0.75rem;
      font-weight:800;
      color:var(--brand-dark);
      margin:0.125rem 0 0.125rem 0;
      padding:0.125rem 0 0.125rem 0;
      border-bottom:1px solid rgba(15,118,110,0.15);
      line-height:1;
    }
    .dashboard-group-title:first-child {
      margin-top:0;
      margin-bottom:0.125rem;
    }

    body.dark header {
      background:linear-gradient(115deg, rgba(5,65,58,0.95), rgba(4,42,38,0.95));
      color:#e6f9f4;
      border-bottom-color:rgba(255,255,255,0.08);
    }
    body.dark .card,
    body.dark .panel,
    body.dark .control-panel,
    body.dark .hero,
    body.dark .filters-inline,
    body.dark .conclusion,
    body.dark .methodology {
      background:var(--card);
      border-color:rgba(94,234,212,0.25);
      box-shadow:0 24px 60px rgba(0,0,0,0.35), inset 0 1px 0 rgba(255,255,255,0.03);
    }
    body.dark .hero-subtitle,
    body.dark p,
    body.dark .menu-index a { color:var(--muted); }
    body.dark .menu-index a:hover,
    body.dark .menu-index a.active { color:var(--ink); background:rgba(94,234,212,0.14); }
    body.dark .menu-index a::before { background:rgba(94,234,212,0.35); }
    body.dark .menu-index a.active::before { background:var(--brand); }
    body.dark .menu-btn { background:rgba(94,234,212,0.12); color:var(--ink); }
    body.dark .menu-btn.primary { background:linear-gradient(135deg, #0f766e, #34d399); }
    body.dark .filters-inline { background:linear-gradient(135deg, rgba(94,234,212,0.08), rgba(94,234,212,0.03)); }
    body.dark .filter-select,
    body.dark .filter-input,
    body.dark .range-value-display,
    body.dark .menu-btn:not(.primary) { border-color:rgba(94,234,212,0.3); background:rgba(6,27,24,0.85); color:var(--ink); }
    body.dark .legend-item,
    body.dark .flag,
    body.dark .insight-card { background:rgba(94,234,212,0.1); border-color:rgba(94,234,212,0.2); color:var(--ink); }
    body.dark .hero-graphic { border-color:rgba(94,234,212,0.25); }
    body.dark .menu-actions .menu-btn { color:var(--ink); }

    /* Optimización completa del modo oscuro para dashboard */
    body.dark .dashboard-sidebar {
      background:var(--card);
      border-color:rgba(94,234,212,0.25);
      box-shadow:0 4px 12px rgba(0,0,0,0.35), inset 0 1px 0 rgba(255,255,255,0.03);
    }
    body.dark .sidebar-insight {
      background:linear-gradient(135deg, rgba(15,30,27,0.95), rgba(10,20,18,0.9));
      border-color:rgba(94,234,212,0.3);
    }
    body.dark .sidebar-insight h3 {
      color:var(--brand-light);
    }
    body.dark .sidebar-insight .control-card p {
      color:var(--ink-light);
    }
    body.dark .sidebar-kpi-card {
      background:rgba(15,30,27,0.8);
      border-color:rgba(94,234,212,0.25);
    }
    body.dark .sidebar-kpi-card.highlight {
      background:linear-gradient(135deg, rgba(94,234,212,0.15), rgba(94,234,212,0.08));
      border-color:rgba(94,234,212,0.4);
    }
    body.dark .sidebar-kpi-title {
      color:var(--ink-light);
      opacity:0.9;
    }
    body.dark .sidebar-kpi-value {
      background:linear-gradient(135deg, var(--brand-light), var(--brand));
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
      background-clip:text;
    }
    body.dark .sidebar-section-title,
    body.dark .sidebar-section h3 {
      color:var(--brand-light);
    }
    body.dark .sidebar-filter-field {
      background:rgba(15,30,27,0.8);
      border-color:rgba(94,234,212,0.25);
    }
    body.dark .sidebar-filter-field:hover {
      border-color:rgba(94,234,212,0.4);
      box-shadow:0 1px 3px rgba(94,234,212,0.15);
    }
    body.dark .sidebar-filter-label {
      color:var(--ink-light);
    }
    body.dark .sidebar-filter-select,
    body.dark .sidebar-filter-input {
      background:rgba(6,27,24,0.9);
      border-color:rgba(94,234,212,0.3);
      color:var(--ink);
    }
    body.dark .sidebar-filter-select:focus,
    body.dark .sidebar-filter-input:focus {
      border-color:var(--brand);
      box-shadow:0 0 0 1px rgba(94,234,212,0.25);
    }
    body.dark .sidebar-filter-reset {
      background:linear-gradient(135deg, rgba(15,30,27,0.95), rgba(10,20,18,0.9));
      border-color:rgba(94,234,212,0.3);
      color:var(--ink);
    }
    body.dark .sidebar-filter-reset:hover {
      border-color:rgba(94,234,212,0.5);
      box-shadow:0 2px 8px rgba(94,234,212,0.2);
    }
    body.dark .sidebar-filters {
      border-top-color:rgba(94,234,212,0.2);
    }
    body.dark .panel {
      background:var(--card);
      border-color:rgba(94,234,212,0.25);
      box-shadow:0 1px 3px rgba(0,0,0,0.2), 0 1px 2px rgba(0,0,0,0.15);
    }
    body.dark .panel-header h3 {
      color:var(--brand-light);
    }
    body.dark .panel-header small {
      color:var(--muted);
    }
    body.dark .chart-card {
      background:var(--card);
      border-color:rgba(94,234,212,0.25);
      box-shadow:0 1px 3px rgba(0,0,0,0.2), 0 1px 2px rgba(0,0,0,0.15);
    }
    body.dark .gap-timeline-table-container {
      border-top-color:rgba(94,234,212,0.2);
    }
    body.dark .gap-timeline-table th {
      color:var(--brand-light);
      border-right-color:rgba(94,234,212,0.25);
    }
    body.dark .gap-timeline-table td {
      color:var(--ink-light);
      border-right-color:rgba(94,234,212,0.15);
      border-bottom-color:rgba(94,234,212,0.15);
    }
    body.dark .gap-timeline-table td:first-child {
      color:var(--brand-light);
      border-right-color:rgba(94,234,212,0.25);
    }
    body.dark .gap-timeline-table tbody tr:hover {
      background:rgba(94,234,212,0.1);
    }
    body.dark .card-insight {
      background:linear-gradient(135deg, rgba(15,30,27,0.95), rgba(10,20,18,0.9));
      border-color:rgba(94,234,212,0.3);
      color:var(--ink-light);
    }
    body.dark .card-insight strong {
      color:var(--brand-light);
    }
    body.dark .control-card {
      background:linear-gradient(135deg, rgba(94,234,212,0.12), rgba(94,234,212,0.06));
      border-color:rgba(94,234,212,0.25);
    }
    body.dark .control-card h4 {
      color:var(--brand-light);
    }
    body.dark .control-card p,
    body.dark .control-card ul {
      color:var(--ink-light);
    }
    body.dark .toggle-slider {
      background-color:rgba(94,234,212,0.3);
    }
    body.dark .toggle-slider:before {
      background-color:var(--ink);
    }
    body.dark .toggle-switch input:checked + .toggle-slider {
      background-color:var(--brand);
    }
    body.dark .dual-range-input {
      background:rgba(6,27,24,0.9);
      border-color:rgba(94,234,212,0.3);
      color:var(--ink);
    }
    body.dark .dual-range-track {
      background:rgba(94,234,212,0.2);
    }
    body.dark .heatmap-tile {
      border-color:rgba(255,255,255,0.15);
    }
    body.dark .heatmap-tile.sin-datos {
      border-color:rgba(94,234,212,0.3);
    }
    body.dark .heatmap-tile:hover {
      border-color:rgba(94,234,212,0.6);
      box-shadow:0 4px 8px rgba(94,234,212,0.25);
    }
    body.dark .heatmap-tile.selected {
      border-color:var(--brand);
      box-shadow:0 0 0 2px rgba(94,234,212,0.3);
    }
    body.dark .panel-gap-timeline .card-insight::-webkit-scrollbar-thumb,
    body.dark .panel-offer .card-insight::-webkit-scrollbar-thumb {
      background:rgba(94,234,212,0.4);
    }
    body.dark .panel-gap-timeline .card-insight::-webkit-scrollbar-track,
    body.dark .panel-offer .card-insight::-webkit-scrollbar-track {
      background:rgba(94,234,212,0.1);
    }
    body.dark .panel-offer-insight::-webkit-scrollbar-thumb {
      background:rgba(94,234,212,0.4);
    }
    body.dark .panel-offer-insight::-webkit-scrollbar-track {
      background:rgba(94,234,212,0.1);
    }
    body.dark .dashboard-sidebar::-webkit-scrollbar-thumb {
      background:rgba(94,234,212,0.4);
    }
    body.dark .dashboard-sidebar::-webkit-scrollbar-track {
      background:rgba(94,234,212,0.1);
    }
    body.dark .sidebar-filters-scroll::-webkit-scrollbar-thumb {
      background:rgba(94,234,212,0.4);
    }
    body.dark .sidebar-filters-scroll::-webkit-scrollbar-track {
      background:rgba(94,234,212,0.1);
    }

    /* Modal de bienvenida */
    .welcome-modal {
      position:fixed;
      top:0;
      left:0;
      right:0;
      bottom:0;
      background:rgba(0,0,0,0.6);
      backdrop-filter:blur(4px);
      z-index:10000;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:1rem;
      animation:fadeIn 0.3s ease;
    }
    @keyframes fadeIn {
      from { opacity:0; }
      to { opacity:1; }
    }
    .welcome-modal-content {
      background:#ffffff;
      border-radius:16px;
      max-width:650px;
      width:100%;
      max-height:90vh;
      overflow-y:auto;
      box-shadow:0 12px 48px rgba(15,118,110,0.25);
      position:relative;
      animation:slideUp 0.3s ease;
      border-top:4px solid var(--brand);
    }
    @keyframes slideUp {
      from {
        transform:translateY(20px);
        opacity:0;
      }
      to {
        transform:translateY(0);
        opacity:1;
      }
    }
    .welcome-modal-close {
      position:absolute;
      top:1rem;
      right:1rem;
      background:none;
      border:none;
      font-size:2rem;
      line-height:1;
      color:var(--muted);
      cursor:pointer;
      padding:0.25rem 0.5rem;
      border-radius:4px;
      transition:all 0.2s ease;
      z-index:10;
    }
    .welcome-modal-close:hover {
      color:var(--brand-dark);
      background:rgba(15,118,110,0.1);
    }
    .welcome-modal-content h2 {
      margin:0;
      padding:2rem 2rem 1.5rem;
      font-size:1.625rem;
      font-weight:700;
      color:var(--brand-dark);
      font-family:'Aptos Regular', sans-serif;
      line-height:1.5;
      background:linear-gradient(135deg, rgba(15,118,110,0.08), rgba(15,118,110,0.03));
      border-bottom:2px solid rgba(15,118,110,0.2);
      padding-bottom:1.5rem;
      margin-bottom:0.5rem;
      text-align:center;
    }
    .welcome-modal-content h2 em {
      font-style:italic;
      color:var(--brand);
    }
    .welcome-modal-body {
      padding:1.5rem 2rem;
      font-size:0.9375rem;
      line-height:1.7;
      color:var(--ink-light);
      background:linear-gradient(135deg, rgba(15,118,110,0.02), rgba(15,118,110,0.05));
    }
    .welcome-modal-body p {
      margin:0 0 1rem;
      text-align:justify;
    }
    .welcome-modal-body p:last-child {
      margin-bottom:0;
    }
    .welcome-modal-body strong {
      color:var(--brand-dark);
      font-weight:700;
      font-size:1rem;
      display:block;
      margin-bottom:0.5rem;
      margin-top:1rem;
    }
    .welcome-modal-body strong:first-of-type {
      margin-top:0;
    }
    .welcome-modal-body ul {
      margin:0.5rem 0 1rem;
      padding-left:1.75rem;
    }
    .welcome-modal-body li {
      margin:0.75rem 0;
      text-align:justify;
      position:relative;
    }
    .welcome-modal-body li strong {
      display:inline;
      margin:0;
      color:var(--brand-dark);
      font-weight:700;
      font-size:inherit;
    }
    .welcome-modal-body li::marker {
      color:var(--brand);
    }
    .welcome-modal-footer {
      padding:1.5rem 2rem 2rem;
      display:flex;
      justify-content:flex-end;
      border-top:2px solid rgba(15,118,110,0.15);
      background:linear-gradient(135deg, rgba(15,118,110,0.03), rgba(15,118,110,0.01));
    }
    .welcome-modal-button {
      background:linear-gradient(135deg, var(--brand), var(--brand-dark));
      color:#ffffff;
      border:none;
      padding:0.875rem 2.5rem;
      border-radius:10px;
      font-size:1rem;
      font-weight:600;
      cursor:pointer;
      transition:all 0.3s ease;
      box-shadow:0 4px 12px rgba(15,118,110,0.25);
    }
    .welcome-modal-button:hover {
      background:linear-gradient(135deg, var(--brand-dark), var(--brand));
      transform:translateY(-2px);
      box-shadow:0 6px 20px rgba(15,118,110,0.4);
    }
    .welcome-modal-button:active {
      transform:translateY(0);
    }
    body.dark .welcome-modal-content {
      background:var(--card);
      border:1px solid rgba(94,234,212,0.3);
      border-top:4px solid var(--brand-light);
      box-shadow:0 12px 48px rgba(94,234,212,0.2);
    }
    body.dark .welcome-modal-content h2 {
      color:var(--brand-light);
      background:linear-gradient(135deg, rgba(94,234,212,0.15), rgba(94,234,212,0.05));
      border-bottom-color:rgba(94,234,212,0.3);
    }
    body.dark .welcome-modal-content h2 em {
      color:var(--brand-light);
    }
    body.dark .welcome-modal-body {
      background:linear-gradient(135deg, rgba(94,234,212,0.05), rgba(94,234,212,0.02));
    }
    body.dark .welcome-modal-body strong {
      color:var(--brand-light);
    }
    body.dark .welcome-modal-body li strong {
      color:var(--brand-light);
    }
    body.dark .welcome-modal-body li::marker {
      color:var(--brand-light);
    }
    body.dark .welcome-modal-close {
      color:var(--ink-light);
    }
    body.dark .welcome-modal-close:hover {
      color:var(--brand-light);
      background:rgba(94,234,212,0.15);
    }
    body.dark .welcome-modal-footer {
      border-top-color:rgba(94,234,212,0.3);
      background:linear-gradient(135deg, rgba(94,234,212,0.05), rgba(94,234,212,0.02));
    }
    body.dark .welcome-modal-button {
      background:linear-gradient(135deg, var(--brand-light), var(--brand));
      box-shadow:0 4px 12px rgba(94,234,212,0.3);
    }
    body.dark .welcome-modal-button:hover {
      background:linear-gradient(135deg, var(--brand), var(--brand-light));
      box-shadow:0 6px 20px rgba(94,234,212,0.4);
    }

    .dashboard-grid {
      display:grid;
      grid-template-columns: repeat(12, 1fr);
      gap:clamp(1rem, 2vw, 1.5rem);
    }
    .card {
      background:var(--card);
      border-radius:18px;
      padding:clamp(1.5rem, 2.5vw, 2.25rem);
      box-shadow:0 16px 48px rgba(0,0,0,0.08), 0 6px 20px rgba(15,118,110,0.1), inset 0 1px 0 rgba(255,255,255,0.9);
      border:2px solid rgba(15,118,110,0.1);
      transition:var(--transition);
      position:relative;
      overflow:hidden;
    }
    .card::before {
      content:'';
      position:absolute;
      top:0;
      left:0;
      right:0;
      height:4px;
      background:linear-gradient(90deg, var(--brand) 0%, var(--brand-light) 50%, var(--accent) 100%);
      opacity:0;
      transition:opacity 0.3s ease, transform 0.3s ease;
      transform:scaleX(0);
      transform-origin:left;
    }
    .card:hover {
      transform:translateY(-6px) scale(1.01);
      box-shadow:0 24px 60px rgba(0,0,0,0.12), 0 10px 24px rgba(15,118,110,0.15), inset 0 1px 0 rgba(255,255,255,1);
      border-color:rgba(15,118,110,0.25);
    }
    .card:hover::before {
      opacity:1;
      transform:scaleX(1);
    }
    .card.half { grid-column: span 6; }
    .card.full { grid-column: span 12; }
    .card.third { grid-column: span 4; }
    .card h3 {
      margin:0 0 1rem;
      font-size:clamp(1.3rem, 2vw, 1.6rem);
      font-weight:800;
      letter-spacing:-0.025em;
      color:var(--brand-dark);
      line-height:1.25;
      display:flex;
      align-items:center;
      gap:0.5rem;
    }
    .card h3::after {
      content:'';
      flex:1;
      height:2px;
      background:linear-gradient(90deg, rgba(15,118,110,0.2), transparent);
      max-width:100px;
    }
    .card p {
      margin:0 0 1.5rem;
      color:var(--muted);
      font-size:0.9375rem;
      line-height:1.7;
      font-weight:500;
    }
    .story-flags {
      display:flex;
      flex-wrap:wrap;
      gap:0.5rem;
      font-size:0.8125rem;
      color:var(--muted);
      margin-bottom:1rem;
    }
    .flag {
      background:linear-gradient(135deg, rgba(255,255,255,0.9), rgba(255,255,255,0.7));
      padding:0.625rem 1rem;
      border-radius:999px;
      border:2px solid rgba(15,118,110,0.2);
      font-weight:700;
      transition:var(--transition);
      font-size:0.8125rem;
      box-shadow:0 2px 6px rgba(15,118,110,0.08);
    }
    .flag:hover {
      background:#fff;
      border-color:var(--brand);
      transform:translateY(-2px) scale(1.05);
      box-shadow:0 4px 12px rgba(15,118,110,0.15);
    }
    .viz {
      min-height:300px;
      position:relative;
      margin-top:1.25rem;
      background:rgba(15,118,110,0.01);
      border-radius:12px;
      padding:0.75rem;
      transition:var(--transition);
    }
    .card:hover .viz {
      background:rgba(15,118,110,0.02);
    }
    .viz canvas, .viz svg {
      width:100%;
      height:100%;
    }
    .double-viz {
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:1rem;
      min-height:300px;
    }
    .double-viz canvas {
      min-height:300px;
    }

    .filters-section {
      position:sticky;
      top:90px;
      z-index:35;
    }
    @media (max-width: 1100px) {
      .filters-section { position:static; }
    }

    .filters-inline {
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap:1.25rem;
      align-items:end;
      margin:2.5rem 0;
      padding:2rem 2.25rem;
      background:linear-gradient(135deg, rgba(255,255,255,0.95) 0%, rgba(248,250,248,0.9) 100%);
      border-radius:18px;
      border:2.5px solid rgba(15,118,110,0.2);
      box-shadow:0 12px 40px rgba(15,118,110,0.12), 0 4px 16px rgba(0,0,0,0.08), inset 0 1px 0 rgba(255,255,255,0.8);
      position:relative;
      overflow:hidden;
    }
    .filters-inline::before {
      content:'';
      position:absolute;
      top:0;
      left:0;
      right:0;
      height:4px;
      background:linear-gradient(90deg, var(--brand), var(--accent));
    }
    .filter-select {
      min-width:160px;
      padding:0.75rem 1rem;
      border:2px solid rgba(15,118,110,0.25);
      border-radius:10px;
      font-family:inherit;
      font-size:0.9375rem;
      font-weight:600;
      background:#fff;
      color:var(--ink);
      cursor:pointer;
      transition:var(--transition);
      box-shadow:0 2px 6px rgba(15,118,110,0.08);
    }
    .filter-select:hover {
      border-color:var(--brand);
      background:#fff;
      box-shadow:0 4px 12px rgba(15,118,110,0.15);
      transform:translateY(-1px);
    }
    .filter-select:focus {
      outline:none;
      border-color:var(--brand);
      box-shadow:0 0 0 4px rgba(15,118,110,0.2), 0 4px 12px rgba(15,118,110,0.15);
      background:#fff;
      transform:translateY(-1px);
    }
    .filter-input[type="range"] {
      min-width:100px;
      height:3px;
      background:var(--pill);
      border:none;
      border-radius:2px;
      cursor:pointer;
      transition:var(--transition);
    }
    .filter-input[type="range"]::-webkit-slider-thumb {
      appearance:none;
      width:10px;
      height:10px;
      border-radius:50%;
      background:var(--brand);
      cursor:pointer;
      box-shadow:0 1px 3px rgba(15,118,110,0.3);
      transition:var(--transition);
    }
    .filter-input[type="range"]::-webkit-slider-thumb:hover {
      transform:scale(1.1);
      box-shadow:0 2px 6px rgba(15,118,110,0.4);
    }
    .filter-input[type="range"]::-moz-range-thumb {
      width:10px;
      height:10px;
      border-radius:50%;
      background:var(--brand);
      cursor:pointer;
      border:none;
      box-shadow:0 1px 3px rgba(15,118,110,0.3);
    }
    .range-value-display {
      padding:0.625rem 1rem;
      background:linear-gradient(135deg, var(--brand), var(--brand-light));
      color:#fff;
      border-radius:10px;
      font-weight:800;
      font-size:0.9375rem;
      min-width:90px;
      text-align:center;
      box-shadow:0 4px 12px rgba(15,118,110,0.3), inset 0 1px 0 rgba(255,255,255,0.2);
      letter-spacing:0.02em;
      transition:var(--transition);
    }
    .range-value-display:hover {
      transform:scale(1.05);
      box-shadow:0 6px 16px rgba(15,118,110,0.4), inset 0 1px 0 rgba(255,255,255,0.3);
    }

    .legend-bar {
      display:flex;
      flex-wrap:wrap;
      gap:0.875rem;
      font-size:0.8125rem;
      color:var(--muted);
      margin:1.25rem 0;
      padding:1rem 1.25rem;
      background:linear-gradient(135deg, rgba(15,118,110,0.06), rgba(15,118,110,0.03));
      border-radius:12px;
      border:1.5px solid rgba(15,118,110,0.1);
    }
    .legend-item {
      display:inline-flex;
      align-items:center;
      gap:0.625rem;
      padding:0.625rem 1rem;
      background:#fff;
      border-radius:12px;
      border:2px solid rgba(15,118,110,0.15);
      font-weight:700;
      transition:var(--transition);
      box-shadow:0 2px 6px rgba(15,118,110,0.08);
    }
    .legend-item:hover {
      border-color:var(--brand);
      transform:translateY(-2px) scale(1.03);
      box-shadow:0 6px 16px rgba(15,118,110,0.15);
      background:#fff;
    }
    .legend-swatch {
      width:18px;
      height:18px;
      border-radius:5px;
      display:inline-block;
      box-shadow:0 3px 6px rgba(0,0,0,0.15), inset 0 1px 0 rgba(255,255,255,0.2);
      flex-shrink:0;
      border:1.5px solid rgba(255,255,255,0.3);
    }
    .legend-swatch.female {
      background:var(--brand);
    }
    .legend-swatch.male {
      background:var(--accent);
    }
    .legend-swatch.parity {
      background:rgba(15,118,110,0.12);
      border:2px dashed var(--brand);
    }

    .controls-row {
      display:flex;
      gap:0.875rem;
      align-items:center;
      flex-wrap:wrap;
      margin-bottom:1.25rem;
      padding:1rem 1.25rem;
      background:linear-gradient(135deg, rgba(15,118,110,0.08), rgba(15,118,110,0.04));
      border-radius:12px;
      border:2px solid rgba(15,118,110,0.12);
      box-shadow:inset 0 1px 3px rgba(15,118,110,0.05);
    }
    .conclusion {
      text-align:left;
      background:linear-gradient(135deg, rgba(15,118,110,0.1), rgba(15,118,110,0.05));
      border-left:5px solid var(--brand);
      position:relative;
      padding-left:clamp(1.75rem, 3vw, 2.5rem);
    }
    .conclusion::before {
      content:'💡';
      position:absolute;
      left:1rem;
      top:1.5rem;
      font-size:1.5rem;
      opacity:0.6;
    }
    .conclusion h3 {
      color:var(--brand-dark);
      font-size:clamp(1.35rem, 2.2vw, 1.65rem);
      font-weight:800;
      margin-bottom:0.75rem;
    }
    .conclusion p {
      font-size:1.0625rem;
      line-height:1.75;
      color:var(--ink-light);
      font-weight:500;
    }

    .tour-overlay {
      position:fixed;
      inset:0;
      background:rgba(0,0,0,0.65);
      backdrop-filter:blur(4px);
      display:none;
      align-items:center;
      justify-content:center;
      z-index:200;
      transition:var(--transition);
    }
    .tour-overlay:not([hidden]) {
      display:flex;
    }
    .tour-card {
      background:#fff;
      padding:1.5rem;
      border-radius:var(--border-radius-large);
      max-width:400px;
      box-shadow:0 24px 60px rgba(0,0,0,0.25);
      border:1px solid rgba(15,118,110,0.1);
    }
    .tour-card h4 {
      margin:0 0 0.5rem;
      font-size:1.2rem;
      font-weight:700;
      color:var(--brand-dark);
      letter-spacing:-0.01em;
    }
    .tour-card p {
      margin:0 0 1rem;
      color:var(--muted);
      font-size:0.9375rem;
      line-height:1.6;
    }
    .tour-actions {
      display:flex;
      justify-content:space-between;
      gap:0.75rem;
      margin-top:1rem;
    }

    /* NUEVOS ESTILOS PARA ESTRUCTURA NARRATIVA */
    .hero-insights {
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(160px,1fr));
      gap:1.25rem;
      margin:2rem 0;
    }
    .insight-card {
      background:linear-gradient(135deg, rgba(255,255,255,0.95), rgba(255,255,255,0.85));
      border:2.5px solid rgba(15,118,110,0.2);
      border-radius:14px;
      padding:1.5rem;
      transition:var(--transition);
      position:relative;
      overflow:hidden;
    }
    .insight-card.highlight {
      border-color:var(--brand);
      background:linear-gradient(135deg, rgba(15,118,110,0.08), rgba(15,118,110,0.04));
    }
    .insight-card.alert {
      border-color:var(--accent);
    }
    .insight-card::before {
      content:'';
      position:absolute;
      top:0;
      left:0;
      right:0;
      height:4px;
      background:linear-gradient(90deg, var(--brand), var(--accent));
      transform:scaleX(0);
      transition:transform 0.3s ease;
    }
    .insight-card:hover::before {
      transform:scaleX(1);
    }
    .insight-value {
      font-size:clamp(1.75rem, 3vw, 2.75rem);
      font-weight:800;
      background:linear-gradient(135deg, var(--brand-dark), var(--brand));
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
      background-clip:text;
      letter-spacing:-0.03em;
      margin-bottom:0.5rem;
      line-height:1;
    }
    .insight-label {
      font-size:0.875rem;
      color:var(--muted);
      font-weight:700;
      text-transform:uppercase;
      letter-spacing:0.05em;
      margin-bottom:0.25rem;
    }
    .insight-context {
      font-size:0.75rem;
      color:var(--muted-light);
      font-weight:500;
    }
    .graphic-label {
      font-size:0.8125rem;
      color:var(--muted);
      font-weight:600;
      text-transform:uppercase;
      letter-spacing:0.1em;
      margin-bottom:1rem;
      text-align:center;
    }

    .filters-section {
      margin:2.5rem 0;
    }
    .filters-header {
      margin-bottom:1.5rem;
    }
    .filters-header h3 {
      margin:0 0 0.5rem;
      font-size:clamp(1.3rem, 2vw, 1.6rem);
      font-weight:800;
      color:var(--brand-dark);
    }
    .filters-header p {
      margin:0;
      color:var(--muted);
      font-size:0.9375rem;
      line-height:1.6;
    }
    .filter-group {
      display:flex;
      flex-direction:column;
      gap:0.5rem;
    }
    .filter-label {
      font-size:0.8125rem;
      color:var(--brand-dark);
      font-weight:700;
      text-transform:uppercase;
      letter-spacing:0.05em;
    }

    .narrative-section {
      margin:3rem 0;
    }
    .section-header {
      margin-bottom:2rem;
      padding-bottom:1.5rem;
      border-bottom:2px solid rgba(15,118,110,0.1);
    }
    .section-title {
      margin:0 0 0.75rem;
      font-size:clamp(1.75rem, 3vw, 2.25rem);
      font-weight:800;
      letter-spacing:-0.03em;
      color:var(--brand-dark);
      line-height:1.2;
    }
    .section-description {
      margin:0;
      color:var(--muted);
      font-size:clamp(1rem, 1.5vw, 1.125rem);
      line-height:1.7;
      max-width:80ch;
    }

    .card-header {
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      margin-bottom:1.25rem;
      flex-wrap:wrap;
      gap:1rem;
    }
    .card-header h3 {
      margin:0;
      flex:1;
      min-width:200px;
    }
    .card-subtitle {
      margin:0.25rem 0 0;
      font-size:0.875rem;
      color:var(--muted);
      font-weight:500;
    }
    .card-legend {
      display:flex;
      flex-wrap:wrap;
      gap:0.75rem;
      align-items:center;
    }
    .legend-item-small {
      display:inline-flex;
      align-items:center;
      gap:0.5rem;
      font-size:0.8125rem;
      color:var(--muted);
      font-weight:600;
    }
    .card-insight {
      margin-top:0.75rem;
      padding:0.75rem 1rem;
      background:linear-gradient(135deg, rgba(15,118,110,0.08), rgba(15,118,110,0.04));
      border-radius:8px;
      border-left:3px solid var(--brand);
      font-size:0.8125rem;
      color:var(--ink-light);
      line-height:1.5;
      text-align:justify;
    }
    .card-insight strong {
      color:var(--brand-dark);
    }

    .comparison-grid {
      display:grid;
      grid-template-columns:repeat(auto-fit, minmax(400px, 1fr));
      gap:1.5rem;
      margin-bottom:1.5rem;
    }
    .insight-comparison {
      padding:1.25rem 1.5rem;
      background:linear-gradient(135deg, rgba(15,118,110,0.1), rgba(15,118,110,0.05));
      border-left:5px solid var(--accent);
      font-size:0.9375rem;
      color:var(--ink-light);
      line-height:1.7;
    }
    .insight-comparison strong {
      color:var(--accent-dark);
    }

    .conclusion-section {
      margin:3rem 0;
    }
    .conclusion-header {
      margin-bottom:1.5rem;
    }
    .conclusion-header h3 {
      margin:0 0 0.5rem;
    }
    .conclusion-subtitle {
      margin:0;
      font-size:0.875rem;
      color:var(--muted);
      font-style:italic;
    }
    .conclusion-content {
      margin-bottom:1.5rem;
    }
    .conclusion-content h4 {
      margin:0 0 0.75rem;
      font-size:1.25rem;
      font-weight:700;
      color:var(--brand-dark);
    }
    .conclusion-actions {
      display:flex;
      gap:0.75rem;
      flex-wrap:wrap;
    }

    .methodology-section {
      margin:3rem 0 2rem;
    }
    .methodology {
      background:linear-gradient(135deg, rgba(15,118,110,0.06), rgba(15,118,110,0.03));
    }
    .methodology h3 {
      margin:0 0 1.5rem;
      font-size:clamp(1.3rem, 2vw, 1.6rem);
      font-weight:800;
      color:var(--brand-dark);
    }
    .methodology-content {
      display:grid;
      grid-template-columns:repeat(auto-fit, minmax(250px, 1fr));
      gap:1rem;
      margin-bottom:1.5rem;
    }
    .methodology-item {
      padding:0.875rem 1rem;
      background:rgba(255,255,255,0.7);
      border-radius:8px;
      border-left:3px solid var(--brand);
      font-size:0.875rem;
      line-height:1.6;
    }
    .methodology-item strong {
      color:var(--brand-dark);
      display:block;
      margin-bottom:0.25rem;
    }
    .methodology-actions {
      display:flex;
      gap:0.75rem;
      flex-wrap:wrap;
    }

    .race-year-display {
      padding:0.625rem 1rem;
      background:var(--brand);
      color:#fff;
      border-radius:8px;
      font-weight:700;
      font-size:0.875rem;
      min-width:100px;
      text-align:center;
      box-shadow:0 2px 6px rgba(15,118,110,0.2);
    }

    @media (max-width: 1200px) {
      .dashboard-layout {
        flex-direction:column;
        max-width:100%;
        height:calc(100vh - 80px);
        min-height:calc(100vh - 80px);
      }
      .dashboard-sidebar {
        width:100%;
        max-width:100%;
        position:static;
        max-height:none;
        flex:0 0 auto;
        height:auto;
      }
      .dashboard-main {
        width:100%;
        flex:1 1 auto;
        min-height:0;
        height:100%;
      }
      .tab1-grid {
        grid-template-columns:repeat(12, 1fr);
        grid-template-rows:1fr 1fr;
        gap:0.75rem;
      }
      .tab1-grid .panel-evolucion {
        grid-column:1 / span 5 !important;
        grid-row:1;
      }
      .tab1-grid .panel-gap-timeline {
        grid-column:6 / span 4 !important;
        grid-row:1;
      }
      .tab1-grid .panel-offer {
        grid-column:10 / span 3 !important;
        grid-row:1;
      }
      .tab1-grid .panel-heatmap {
        grid-column:1 / span 6 !important;
        grid-row:2;
      }
      .tab1-grid .panel-scatter {
        grid-column:7 / span 6 !important;
        grid-row:2;
      }
    }
    @media (max-width: 768px) {
      .dashboard-layout {
        padding:0.5rem;
        height:calc(100vh - 80px);
        min-height:calc(100vh - 80px);
      }
      .sidebar-kpis {
        grid-template-columns:1fr;
      }
      .tab1-grid {
        grid-template-columns:1fr;
        grid-template-rows:repeat(5, 1fr);
        gap:0.5rem;
      }
      .panel {
        padding:0.5rem;
      }
      .tab1-grid .panel-evolucion {
        grid-column:1;
        grid-row:1;
      }
      .tab1-grid .panel-gap-timeline {
        grid-column:1;
        grid-row:2;
      }
      .tab1-grid .panel-offer {
        grid-column:1;
        grid-row:3;
      }
      .tab1-grid .panel-heatmap {
        grid-column:1;
        grid-row:4;
      }
      .tab1-grid .panel-scatter {
        grid-column:1;
        grid-row:5;
      }
      .rankings-combined {
        grid-template-columns:1fr;
        gap:1rem;
      }
      .panel-header h3 {
        font-size:0.875rem;
      }
      header {
        padding:0.5rem 0.75rem;
      }
      header h1 {
        font-size:0.875rem;
      }
      header .meta {
        font-size:0.5rem;
      }
      .header-link {
        padding:0.4rem 0.8rem;
        font-size:0.6875rem;
      }
    }
    @media (max-width: 480px) {
      .dashboard-layout {
        padding:0.35rem;
        min-height:calc(100vh - 70px);
      }
      .sidebar-kpis {
        grid-template-columns:1fr;
      }
      .tab1-grid {
        gap:0.35rem;
        grid-template-rows:repeat(5, 1fr);
      }
      .panel {
        padding:0.4rem;
      }
      .dashboard-sidebar {
        padding:0.4rem;
      }
    }

    @media (max-width: 900px) and (min-width: 769px) {
      .tab1-grid {
        grid-template-columns:1fr 1fr;
        grid-template-rows:repeat(3, 1fr);
        gap:0.5rem;
      }
      .tab1-grid .panel-evolucion {
        grid-column:1;
        grid-row:1;
      }
      .tab1-grid .panel-gap-timeline {
        grid-column:2;
        grid-row:1;
      }
      .tab1-grid .panel-offer {
        grid-column:1 / span 2;
        grid-row:2;
      }
      .tab1-grid .panel-heatmap {
        grid-column:1;
        grid-row:3;
      }
      .tab1-grid .panel-scatter {
        grid-column:2;
        grid-row:3;
      }
      .story-block { grid-template-columns:1fr; }
      .comparison-grid { grid-template-columns:1fr; }
      .card-header { flex-direction:column; }
      .methodology-content { grid-template-columns:1fr; }
    }

    /* ESTILOS PARA PESTAÑAS PRINCIPALES */
    /* Reglas CSS de main-tabs y main-tab eliminadas - ya no hay pestañas en el dashboard */
    /* Reglas CSS de tab-content eliminadas - ya no hay pestañas en el dashboard */
    .rankings-combined {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0.75rem;
      flex: 1 1 0;
      min-height: 0;
      overflow: hidden;
    }
    .rankings-combined > div {
      display: flex;
      flex-direction: column;
      min-height: 0;
      overflow: hidden;
    }
    .rankings-combined .panel-header {
      flex-shrink: 0;
      margin-bottom: 0.5rem;
    }
    .rankings-combined .panel-body {
      flex: 1 1 0;
      min-height: 0;
      overflow: hidden;
    }

    /* Tooltips informativos */
    [data-tooltip] {
      position: relative;
      cursor: help;
    }
    [data-tooltip]:hover::after {
      content: attr(data-tooltip);
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      padding: 0.5rem 0.75rem;
      background: rgba(8, 15, 13, 0.95);
      color: #ffffff;
      font-size: 0.6875rem;
      font-weight: 500;
      line-height: 1.4;
      white-space: nowrap;
      border-radius: 6px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25);
      z-index: 10000;
      pointer-events: none;
      margin-bottom: 0.5rem;
      max-width: 250px;
      white-space: normal;
      text-align: center;
    }
    [data-tooltip]:hover::before {
      content: '';
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      border: 5px solid transparent;
      border-top-color: rgba(8, 15, 13, 0.95);
      margin-bottom: -5px;
      z-index: 10001;
      pointer-events: none;
    }
    body.dark [data-tooltip]:hover::after {
      background: rgba(5, 15, 13, 0.98);
      color: #effaf7;
    }
    body.dark [data-tooltip]:hover::before {
      border-top-color: rgba(5, 15, 13, 0.98);
    }

    /* Mejoras en estados hover */
    .header-link:hover {
      background: rgba(255, 255, 255, 0.4) !important;
      border-color: rgba(255, 255, 255, 0.8) !important;
      transform: translateY(-1px);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
    }
    button.header-link:hover {
      background: rgba(255, 255, 255, 0.4) !important;
    }
    .sidebar-filter-select:hover,
    .sidebar-filter-input:hover {
      border-color: rgba(15, 118, 110, 0.4) !important;
      box-shadow: 0 0 0 2px rgba(15, 118, 110, 0.1);
    }
    .sidebar-filter-reset:hover {
      background: linear-gradient(135deg, rgba(15, 118, 110, 0.1), rgba(15, 118, 110, 0.05)) !important;
      border-color: rgba(15, 118, 110, 0.4) !important;
      transform: translateY(-2px) !important;
      box-shadow: 0 4px 12px rgba(15, 118, 110, 0.2) !important;
    }
    .toggle-switch:hover .toggle-slider {
      box-shadow: 0 0 0 3px rgba(15, 118, 110, 0.15);
    }
    .toggle-switch input:checked:hover + .toggle-slider {
      box-shadow: 0 0 0 3px rgba(15, 118, 110, 0.2);
    }
    .heatmap-tile:hover {
      transform: translateY(-3px) scale(1.03) !important;
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2) !important;
      border-color: var(--brand-dark) !important;
      z-index: 10;
    }
    .heatmap-tile.selected:hover {
      border-color: var(--brand) !important;
      box-shadow: 0 0 0 3px rgba(15, 118, 110, 0.2), 0 6px 12px rgba(0, 0, 0, 0.2) !important;
    }
    .sidebar-kpi-card:hover {
      transform: translateY(-2px) !important;
      box-shadow: 0 4px 12px rgba(15, 118, 110, 0.18) !important;
      border-color: rgba(15, 118, 110, 0.35) !important;
    }
    .sidebar-filter-field:hover {
      transform: translateY(-2px) !important;
      box-shadow: 0 2px 6px rgba(15, 118, 110, 0.12) !important;
      border-color: rgba(15, 118, 110, 0.3) !important;
    }
    .gap-timeline-table tbody tr:hover {
      background: rgba(15, 118, 110, 0.06) !important;
      transform: scale(1.01);
    }
    body.dark .header-link:hover {
      background: rgba(255, 255, 255, 0.15) !important;
    }
    body.dark .sidebar-filter-select:hover,
    body.dark .sidebar-filter-input:hover {
      border-color: rgba(94, 234, 212, 0.5) !important;
      box-shadow: 0 0 0 2px rgba(94, 234, 212, 0.15);
    }
    body.dark .sidebar-filter-reset:hover {
      background: linear-gradient(135deg, rgba(94, 234, 212, 0.15), rgba(94, 234, 212, 0.08)) !important;
      border-color: rgba(94, 234, 212, 0.6) !important;
    }
    body.dark .toggle-switch:hover .toggle-slider {
      box-shadow: 0 0 0 3px rgba(94, 234, 212, 0.2);
    }
    body.dark .heatmap-tile:hover {
      border-color: rgba(94, 234, 212, 0.7) !important;
      box-shadow: 0 6px 12px rgba(94, 234, 212, 0.3) !important;
    }
    body.dark .sidebar-kpi-card:hover {
      border-color: rgba(94, 234, 212, 0.4) !important;
      box-shadow: 0 4px 12px rgba(94, 234, 212, 0.2) !important;
    }
    body.dark .sidebar-filter-field:hover {
      border-color: rgba(94, 234, 212, 0.4) !important;
      box-shadow: 0 2px 6px rgba(94, 234, 212, 0.15) !important;
    }
    body.dark .gap-timeline-table tbody tr:hover {
      background: rgba(94, 234, 212, 0.12) !important;
    }

    /* Feedback visual para filtros activos */
    .sidebar-filter-field.active {
      border-color: var(--brand) !important;
      background: linear-gradient(135deg, rgba(15, 118, 110, 0.08), rgba(15, 118, 110, 0.04)) !important;
      box-shadow: 0 0 0 2px rgba(15, 118, 110, 0.15);
    }
    .sidebar-filter-field.active .sidebar-filter-label {
      color: var(--brand-dark);
      font-weight: 700;
    }
    .sidebar-filter-select.active,
    .sidebar-filter-input.active {
      border-color: var(--brand) !important;
      background: linear-gradient(135deg, rgba(15, 118, 110, 0.05), rgba(255, 255, 255, 0.95)) !important;
      font-weight: 600;
    }
    .toggle-switch.active .toggle-slider {
      box-shadow: 0 0 0 3px rgba(15, 118, 110, 0.2);
    }
    body.dark .sidebar-filter-field.active {
      border-color: rgba(94, 234, 212, 0.5) !important;
      background: linear-gradient(135deg, rgba(94, 234, 212, 0.12), rgba(94, 234, 212, 0.06)) !important;
      box-shadow: 0 0 0 2px rgba(94, 234, 212, 0.2);
    }
    body.dark .sidebar-filter-field.active .sidebar-filter-label {
      color: var(--brand-light);
    }
    body.dark .sidebar-filter-select.active,
    body.dark .sidebar-filter-input.active {
      border-color: rgba(94, 234, 212, 0.5) !important;
      background: linear-gradient(135deg, rgba(94, 234, 212, 0.1), rgba(6, 27, 24, 0.95)) !important;
    }
    body.dark .toggle-switch.active .toggle-slider {
      box-shadow: 0 0 0 3px rgba(94, 234, 212, 0.3);
    }

    /* Contador de resultados */
    .filter-results-counter {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.5rem 0.75rem;
      margin: 0.5rem 0;
      background: linear-gradient(135deg, rgba(15, 118, 110, 0.06), rgba(15, 118, 110, 0.03));
      border: 1px solid rgba(15, 118, 110, 0.2);
      border-radius: 6px;
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--brand-dark);
    }
    .filter-results-counter .counter-value {
      font-size: 0.875rem;
      font-weight: 700;
      color: var(--brand);
      background: linear-gradient(135deg, var(--brand-dark), var(--brand));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    body.dark .filter-results-counter {
      background: linear-gradient(135deg, rgba(94, 234, 212, 0.1), rgba(94, 234, 212, 0.05));
      border-color: rgba(94, 234, 212, 0.3);
      color: var(--ink-light);
    }
    body.dark .filter-results-counter .counter-value {
      background: linear-gradient(135deg, var(--brand-light), var(--brand));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
  </style>
</head>
<body>
  <header>
    <div>
      <h1>¿Quién juega y quién se queda fuera?</h1>
      <div class="meta">Reto Periodismo de Datos Bizkaia 2025 | Categoría: Representación dinámica de datos · Deporte Escolar Bizkaia · 2018-2024</div>
    </div>
    <div class="header-actions">
      <a class="header-link" href="https://opendata-reportaje-irenetobajas.vercel.app/" target="_blank" rel="noopener">📄 Reportaje</a>
      <a class="header-link" href="https://www.opendatabizkaia.eus/es/catalogo/deporte-escolar" target="_blank" rel="noopener">💾 Dataset</a>
      <button class="header-link" id="toggle-theme-header">🌙 Modo</button>
    </div>
  </header>

  <!-- Modal de bienvenida -->
  <div id="welcome-modal" class="welcome-modal" style="display:none;">
    <div class="welcome-modal-content">
      <button class="welcome-modal-close" id="welcome-modal-close">×</button>
      <h2>Bienvenid@ a esta representación dinámica del deporte escolar en Bizkaia:<br><em>"¿Quién juega y quién se queda fuera?"</em></h2>
      <div class="welcome-modal-body">
        <p><strong>¿Qué muestra este dashboard?</strong></p>
        <p>Este dashboard explora la participación en el deporte escolar en Bizkaia desde 2018 hasta 2024, analizando la distribución por género, deportes y categorías de competición. Descubre qué deportes tienen mayor participación, cuáles están más cerca de la paridad de género y cómo ha evolucionado la brecha a lo largo del tiempo.</p>
        
        <p><strong>¿Cómo interactuar?</strong></p>
        <ul>
          <li><strong>Filtros globales:</strong> Usa los filtros del panel izquierdo para filtrar por temporada, deporte o excluir casos extremos.</li>
          <li><strong>Filtros interactivos:</strong> Haz clic en cualquier elemento de los visuales (barras, recuadros, burbujas, puntos) para filtrar el dashboard. Vuelve a hacer clic para desactivar el filtro.</li>
          <li><strong>Observación dinámica:</strong> El panel izquierdo muestra observaciones contextuales que se adaptan a los filtros seleccionados.</li>
        </ul>
      </div>
      <div class="welcome-modal-footer">
        <button class="welcome-modal-button" id="welcome-modal-understood">Entendido</button>
      </div>
    </div>
  </div>

  <main class="dashboard-container">
    <div class="command-center">
      <div class="command-center-main dashboard-layout">
        <aside class="control-panel dashboard-sidebar">
        <div class="sidebar-top">
          <div class="sidebar-insight">
            <h3>Observación dinámica</h3>
            <div class="control-card">
              <p id="conclusion-text" style="font-size:0.75rem; margin:0; line-height:1.4;">Ajusta los filtros para generar una observación personalizada.</p>
            </div>
          </div>
          
          <div class="sidebar-kpis">
            <div class="sidebar-kpi-card">
              <div class="sidebar-kpi-title"># Participantes</div>
              <div class="sidebar-kpi-value" id="teaser-total">-</div>
            </div>
            <div class="sidebar-kpi-card highlight">
              <div class="sidebar-kpi-title">% Femenino</div>
              <div class="sidebar-kpi-value" id="teaser-fem">-</div>
            </div>
          </div>
        </div>
        
        <div class="sidebar-main">
          <section class="sidebar-filters">
            <h3 class="sidebar-section-title">Filtros globales</h3>
            <div class="sidebar-filters-scroll">
              <div class="sidebar-filters-list">
                <div class="sidebar-filter-field">
                  <div class="sidebar-filter-label">
                    <span>📅 Temporada</span>
                  </div>
                  <select class="sidebar-filter-select" id="temporada-filter">
                    <option value="todas" selected>Todas</option>
                    <option value="2018-2019">2018-19</option>
                    <option value="2019-2020">2019-20</option>
                    <option value="2021-2022">2021-22</option>
                    <option value="2022-2023">2022-23</option>
                    <option value="2023-2024">2023-24</option>
                  </select>
                </div>
                <div class="sidebar-filter-field">
                  <div class="sidebar-filter-label">
                    <span>🏃 Deporte</span>
                  </div>
                  <select class="sidebar-filter-select" id="deporte-filter">
                    <option value="todos">Todos</option>
                  </select>
                </div>
                <div class="sidebar-filter-field">
                  <div class="sidebar-filter-label" style="display:flex; align-items:center; justify-content:space-between; margin-bottom:0.5rem;">
                    <span>🔍 Excluir casos extremos</span>
                    <label class="toggle-switch">
                      <input type="checkbox" id="exclude-outliers-toggle">
                      <span class="toggle-slider"></span>
                    </label>
                  </div>
                  <p style="font-size:0.6875rem; color:var(--muted); margin:0; line-height:1.3;">Excluye Fútbol, Baloncesto y Gimnasia</p>
                </div>
                <div class="sidebar-filter-field">
                  <button class="sidebar-filter-reset" id="reset-filters">🔄 Restablecer</button>
                </div>
              </div>
            </div>
          </section>
          
        </div>
        
        <!-- Recuadro flotante explicativo sobre filtros de clic -->
        <div class="click-filter-info">
          <div class="click-filter-info-content">
            <strong>⚙️ Filtros interactivos:</strong>
            <p>Haz clic en cualquier elemento de los visuales (barras, recuadros, burbujas, puntos) para filtrar el dashboard. Vuelve a hacer clic para desactivar el filtro.</p>
          </div>
        </div>
      </aside>

      <div class="dashboard-main">
        <div class="sidebar-top">
      <!-- Contenido principal del dashboard -->
      <section id="tab-participacion">
        <div class="viz-grid tab1-grid">
          <!-- 1. Evolución global (línea) -->
          <article class="panel large panel-evolucion chart-card">
            <div class="panel-header">
              <h3>¿Cómo evoluciona la participación por género?</h3>
            </div>
            <div class="panel-body"><canvas id="hero-chart"></canvas></div>
          </article>
          
          <!-- 2. ¿Cuándo se abre la brecha? -->
          <article class="panel panel-gap-timeline chart-card">
            <div class="panel-header">
              <h3>¿Cuándo se abre la brecha?</h3>
              <p style="font-size:0.6875rem; color:var(--muted); margin:0.25rem 0 0; font-weight:400;">Diferencia en puntos porcentuales entre participación masculina y femenina</p>
            </div>
            <div class="panel-body"><canvas id="gap-timeline-chart"></canvas></div>
            <div class="gap-timeline-table-container" style="padding:0.5rem 1rem;">
              <table class="gap-timeline-table" id="gap-timeline-table">
                <thead id="gap-timeline-table-head">
                  <!-- Se poblará dinámicamente con temporadas como headers -->
                </thead>
                <tbody id="gap-timeline-table-body">
                  <!-- Se poblará dinámicamente con Femenino y Masculino como filas -->
                </tbody>
              </table>
            </div>
            <div class="card-insight" id="gap-timeline-insight"><strong>💡</strong> <span id="gap-timeline-text">Evolución de la brecha de género</span></div>
          </article>
          
          <!-- 3. Oferta por categoría (competición 2024-25) -->
          <article class="panel panel-offer chart-card">
            <div class="panel-header">
              <h3>¿Qué categorías se ofrecen?</h3>
              <p style="font-size:0.6875rem; color:var(--muted); margin:0.25rem 0 0; font-weight:400;">Haz clic en una barra para filtrar el dashboard por esa categoría</p>
            </div>
            <div class="panel-body">
              <canvas id="offer-category-chart"></canvas>
            </div>
            <div class="card-insight panel-offer-insight" style="min-height:auto; padding:0.8rem 1rem; line-height:1.5;"><strong>💡</strong> <span id="offer-category-insight-text">Carga inicial de la oferta 2024-25.</span></div>
          </article>
          
          <!-- 4. Heatmap de deportes (% participación femenina) -->
          <article class="panel panel-heatmap chart-card">
            <div class="panel-header">
              <h3>¿Cómo se distribuye la participación femenina por deporte?</h3>
              <div style="display:flex; align-items:center; gap:0.5rem; font-size:0.625rem; flex-wrap:wrap;">
                <span style="display:flex; align-items:center; gap:0.25rem;">
                  <span style="display:inline-block; width:12px; height:12px; background:rgba(255,138,61,0.85); border-radius:2px;"></span>
                  <span>&lt;25% o &gt;75%</span>
                </span>
                <span style="display:flex; align-items:center; gap:0.25rem;">
                  <span style="display:inline-block; width:12px; height:12px; background:rgba(251,191,36,0.8); border-radius:2px;"></span>
                  <span>25-40% o 60-75%</span>
                </span>
                <span style="display:flex; align-items:center; gap:0.25rem;">
                  <span style="display:inline-block; width:12px; height:12px; background:rgba(34,197,94,0.7); border-radius:2px;"></span>
                  <span>40-45% o 55-60%</span>
                </span>
                <span style="display:flex; align-items:center; gap:0.25rem;">
                  <span style="display:inline-block; width:12px; height:12px; background:rgba(22,163,74,0.85); border-radius:2px;"></span>
                  <span>45-55% (paridad)</span>
                </span>
              </div>
            </div>
            <div class="panel-body" style="padding:0.75rem; overflow-y:auto;">
              <div id="heatmapDeportes" class="heatmap-container"></div>
            </div>
          </article>

          <!-- 5. Mapa de Paridad (bubble plot optimizado) -->
          <article class="panel panel-scatter chart-card">
            <div class="panel-header"><h3>¿Qué deportes están más cerca de la paridad de género?</h3></div>
            <div class="panel-body"><canvas id="scatter-chart"></canvas></div>
          </article>
        </div>
      </section>
      </div>
      </div>
    </div>
  </main>


  <div class="tour-overlay" id="tour-overlay" hidden>
    <div class="tour-card">
      <p class="eyebrow">Guía rápida</p>
      <h4 id="tour-title">Mueve el slider para ver el cambio por años</h4>
      <p id="tour-text">Usa el slider del race chart para ver cómo cambia el ranking de deportes.</p>
      <div class="tour-actions">
        <button class="btn secondary" id="tour-skip">Saltar</button>
        <button class="btn" id="tour-next">Siguiente</button>
      </div>
    </div>
  </div>

  <footer style="text-align:center; padding:1rem; color:var(--muted); font-size:0.75rem; line-height:1.4; border-top:1px solid rgba(15,118,110,0.1); background:rgba(255,255,255,0.5);">
    <p style="margin:0; font-size:0.8125rem; font-weight:500;">Fuente: Open Data Bizkaia | Representación creada por: Irene Tobajas Sebastián</p>
  </footer>

  <script defer src="https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0"></script>
  <script defer src="dashboard.js"></script>
</body>
</html>
